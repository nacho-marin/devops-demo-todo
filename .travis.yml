# You must sign into travis-ci.org and set the commit hook on your project for travis to
# run on your project. The secure: variable must be generated by running `travis encrypt`
# on a github oauth key that you can generate using curl.

sudo: false
language: node_js
node_js:
  - '9.3.0'
notifications:
    email:
    recipients:
      - one@example.com
      - other@example.com
    on_success: never # Notification disabled in case of build success
    on_failure: never # Notification disabled in case of build failure
cache:
  directories:
    - tooling/node_modules
    - tests/node_modules
    - node_modules
env:
  global:
    # GH_OAUTH_TOKEN is the oauth token generated as described at
    # https://help.github.com/articles/creating-an-oauth-token-for-command-line-use
    #
    # curl -u 'username' -d '{"scopes":["repo"],"note":"push to gh-pages from travis"}' https://api.github.com/authorizations
    #
    # It must be encrypted using the travis gem
    # http://about.travis-ci.org/docs/user/build-configuration/#Secure-environment-variables
    #
    # travis encrypt GH_OAUTH_TOKEN=XXXXXXXXXXXXXXX
    #
    # User specific env variables
    - secure: 'fHgfjMpYuliwMr2QLnjYZExIViNrxprf9dhXRBLZ6P9Hz7P6m1BMYrI/xEG8X+fFbCi0+n3AXh8SEMHi9ou/Pty/cx12z4w/z3B2BHMxh4XBwpZHs+AB4IXkLiwwWoP4QFy4vTipgYnMDMq9CRhlRbhZEpenQBmaTEc472By1uM='
    - GH_OWNER: tastejs
    - GH_PROJECT_NAME: todomvc
    - CHROME_PATH: '/home/travis/build/tastejs/todomvc/chrome-linux/chrome'


before_install:
  - npm install --global npm@5.8.0 #Update npm to latest stable version
  - cd examples/backbone_marionette #Set working directory
  - npm install --save-dev http-server #Installs the http-server module in dev mode
 

jobs:
  include:
    - stage: Build & Test
      script:        
        - npm ci #Installs a project with a clean state
      before_script:
        - sh ./tests/start-server.sh #Starts a http-server in the background
      script:
        - npm test #Runs the tests indicated in the package.json file